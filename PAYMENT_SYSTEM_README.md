# Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ - Payment System

## Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø¸Ø§Ù… Ø¯ÙØ¹ Ù…ØªÙƒØ§Ù…Ù„ ÙŠØ¯Ø¹Ù… **3 Ø·Ø±Ù‚ Ø¯ÙØ¹ Ù…Ø®ØªÙ„ÙØ©** Ù„Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ© ÙˆØ§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø§Øª:

1. **PayPal** - Ø¯ÙØ¹ ÙÙˆØ±ÙŠ Ø¹Ø¨Ø± PayPal
2. **Stripe** - Ø¯ÙØ¹ Ø¨Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†/Ø®ØµÙ…
3. **Bank Transfer** - ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ Ù…Ø¨Ø§Ø´Ø±

---

## Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª

### âœ… ØµÙØ­Ø© Checkout Ù…ÙˆØ­Ø¯Ø©
- ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø© Ù„Ù„Ø¯ÙØ¹ ØªØ¹Ù…Ù„ Ù„Ù„Ø¯ÙˆØ±Ø§Øª ÙˆØ§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø§Øª
- Ø¹Ø±Ø¶ Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø´ÙƒÙ„ ÙˆØ§Ø¶Ø­
- Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ø¨ÙˆØ§Ø¬Ù‡Ø© Ø³Ù‡Ù„Ø©

### âœ… Ø¯Ø¹Ù… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ù†ÙƒÙŠ
- Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ
- Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„
- Ù†Ø¸Ø§Ù… ØªØ­Ù‚Ù‚ Ø¥Ø¯Ø§Ø±ÙŠ (Approval System)

### âœ… Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø¥Ø¯Ø§Ø±ÙŠØ©
- Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
- Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ©
- Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ø¨Ø­Ø¬Ù… ÙƒØ§Ù…Ù„
- Ù‚Ø¨ÙˆÙ„ Ø£Ùˆ Ø±ÙØ¶ Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª

---

## ÙƒÙŠÙÙŠØ© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…

### Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø§Ù„Ø¹Ù…ÙŠÙ„)

#### 1. Ø´Ø±Ø§Ø¡ Ø¯ÙˆØ±Ø© ØªØ¯Ø±ÙŠØ¨ÙŠØ©
```
1. Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ø¯ÙˆØ±Ø©
2. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø§Ø´ØªØ±Ù Ø§Ù„Ø¢Ù†"
3. Ø³ÙŠØªÙ… ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø¥Ù„Ù‰ ØµÙØ­Ø© Checkout
4. Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…ÙØ¶Ù„Ø©
5. Ø£ÙƒÙ…Ù„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯ÙØ¹
```

#### 2. Ø­Ø¬Ø² Ø§Ø³ØªØ´Ø§Ø±Ø©
```
1. Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø§Øª
2. Ø§Ø®ØªØ± Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©
3. Ø§Ù…Ù„Ø£ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²
4. Ø³ÙŠØªÙ… ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø¥Ù„Ù‰ ØµÙØ­Ø© Checkout
5. Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ ÙˆØ£ÙƒÙ…Ù„
```

#### 3. Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ù†ÙƒÙŠ
```
1. Ø§Ø®ØªØ± "ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ" ÙƒØ·Ø±ÙŠÙ‚Ø© Ø¯ÙØ¹
2. Ø§Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©
3. Ù‚Ù… Ø¨Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù…Ù† Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
4. Ø§Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„
5. Ø§Ù†ØªØ¸Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
```

---

### Ù„Ù„Ù…Ø¯ÙŠØ± (Admin)

#### Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ©

1. **Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª**
   ```
   /admin/orders
   ```

2. **ÙÙ„ØªØ±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ©**
   - Ø§Ø³ØªØ®Ø¯Ù… ÙÙ„ØªØ± "Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹" ÙˆØ§Ø®ØªØ± "Bank Transfer"
   - Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© Ø³ØªØ¸Ù‡Ø± Ø¨Ø­Ø§Ù„Ø© "pending"

3. **Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„**
   - Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨ Ù„ÙØªØ­ Ø§Ù„ØªÙØ§ØµÙŠÙ„
   - ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„
   - Ø§Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„ (Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø© Ù„Ø¹Ø±Ø¶Ù‡Ø§ Ø¨Ø§Ù„Ø­Ø¬Ù… Ø§Ù„ÙƒØ§Ù…Ù„)

4. **Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø£Ùˆ Ø§Ù„Ø±ÙØ¶**
   - Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© ÙˆØ§Ù„ØªÙØ¹ÙŠÙ„" Ù„Ù‚Ø¨ÙˆÙ„ Ø§Ù„ØªØ­ÙˆÙŠÙ„
   - Ø£Ùˆ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø±ÙØ¶" Ù…Ø¹ ÙƒØªØ§Ø¨Ø© Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶
   - Ø¹Ù†Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©:
     - ÙŠØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ±Ø©/Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
     - ÙŠØ­ØµÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù„Ù‰ Ø§Ù„ÙˆØµÙˆÙ„ ÙÙˆØ±Ø§Ù‹
     - ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…

---

## Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ

Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶ Ø­Ø§Ù„ÙŠØ§Ù‹ Ù„Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª:
- **Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ**: Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù‡Ù„ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ
- **Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨**: SA1234567890123456
- **Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙÙŠØ¯**: Ø·Ù‡ Ø§Ù„ØµØ¨Ø§Øº
- **IBAN**: SA1234567890123456

> ğŸ“ **Ù…Ù„Ø§Ø­Ø¸Ø©**: ÙŠÙ…ÙƒÙ† ØªØ­Ø¯ÙŠØ« Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙÙŠ Ù…Ù„Ù:
> `/client/src/app/checkout/page.tsx` (Ø§Ù„Ø³Ø·ÙˆØ± 226-236)

---

## Ø§Ù„ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Backend

### API Endpoints Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©

#### 1. PayPal
```
POST /api/payment/paypal/create-order
POST /api/payment/paypal/capture
```

#### 2. Stripe
```
POST /api/payment/stripe/create-session
```

#### 3. Bank Transfer
```
POST /api/payment/bank-transfer/create-order
POST /api/payment/bank-transfer/upload-receipt/:orderId
PUT  /api/payment/bank-transfer/verify/:orderId (Admin only)
```

---

## Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

### Order Schema
ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ¯ÙŠÙ„ `Order` Ù„Ø¯Ø¹Ù… Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ©:

```javascript
bankTransfer: {
  receiptImage: String,           // Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„
  receiptImagePublicId: String,   // Ù…Ø¹Ø±Ù Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ Cloudinary
  transferDate: Date,             // ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­ÙˆÙŠÙ„
  transferReference: String,      // Ø±Ù‚Ù… Ù…Ø±Ø¬Ø¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„
  bankName: String,               // Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ
  accountHolderName: String,      // Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ø­Ø³Ø§Ø¨
  verificationStatus: String,     // pending/verified/rejected
  verifiedBy: ObjectId,           // Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø°ÙŠ ÙˆØ§ÙÙ‚
  verifiedAt: Date,               // ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
  rejectionReason: String         // Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶ (Ø¥Ù† ÙˆØ¬Ø¯)
}
```

---

## Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ù‡Ù…Ø©

### Frontend
```
/client/src/app/checkout/page.tsx                        - ØµÙØ­Ø© Checkout Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
/client/src/app/courses/[id]/page.tsx                   - ØªÙ… ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„Ø´Ø±Ø§Ø¡
/client/src/components/consultation/ConsultationBookingModal.tsx  - ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø¬Ø²
/client/src/components/admin/OrderDetailsModal.tsx      - Ù…ÙˆØ¯Ø§Ù„ Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨
/client/src/app/admin/orders/page.tsx                   - ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª
```

### Backend
```
/server/src/models/Order.js                             - Ù…ÙˆØ¯ÙŠÙ„ Order Ø§Ù„Ù…Ø­Ø¯Ø«
/server/src/routes/payment.js                           - Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ø¯ÙØ¹
```

---

## Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© (Stripe Integration)

Ø­Ø§Ù„ÙŠØ§Ù‹ØŒ Stripe ÙŠØ¹Ù…Ù„ ÙƒÙ€ **mock** (ØªØ¬Ø±ÙŠØ¨ÙŠ). Ù„ØªÙØ¹ÙŠÙ„Ù‡ Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„:

### Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:

1. **Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙØ§ØªÙŠØ­ Stripe**
   ```
   https://dashboard.stripe.com/apikeys
   ```

2. **Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø¥Ù„Ù‰ `.env`**
   ```
   STRIPE_SECRET_KEY=sk_test_...
   STRIPE_PUBLISHABLE_KEY=pk_test_...
   ```

3. **ØªØ«Ø¨ÙŠØª Stripe SDK**
   ```bash
   cd server
   npm install stripe
   ```

4. **ØªØ­Ø¯ÙŠØ« Payment Route**
   ÙÙŠ `/server/src/routes/payment.js`, Ø§Ø³ØªØ¨Ø¯Ù„ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ø¹Ù„Ù… Ø¨Ù€ TODO:
   ```javascript
   // TODO: Implement actual Stripe integration
   const stripe = require('stripe')(process.env.STRIPE_SECRET_KEY);
   
   const session = await stripe.checkout.sessions.create({
     payment_method_types: ['card'],
     line_items: [{
       price_data: {
         currency: currency.toLowerCase(),
         product_data: {
           name: title,
         },
         unit_amount: amount * 100,
       },
       quantity: 1,
     }],
     mode: 'payment',
     success_url: `${process.env.CLIENT_URL}/payment/success?session_id={CHECKOUT_SESSION_ID}`,
     cancel_url: `${process.env.CLIENT_URL}/checkout`,
   });
   
   res.json({
     success: true,
     sessionId: session.id,
     checkoutUrl: session.url,
     order: orderRecord
   });
   ```

---

## Ø§Ù„Ø¯Ø¹Ù… ÙˆØ§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©

Ù„Ù„Ø£Ø³Ø¦Ù„Ø© Ø£Ùˆ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©:
- Ø±Ø§Ø¬Ø¹ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª ÙÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª
- ØªØ­Ù‚Ù‚ Ù…Ù† console logs ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­/Ø§Ù„Ø³ÙŠØ±ÙØ±
- ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙŠØ±ÙØ± ÙˆØ§Ù„ÙƒÙ„Ø§ÙŠÙ†Øª Ù…Ø¹Ø§Ù‹

---

## Ø§Ù„Ø®Ù„Ø§ØµØ©

âœ… Ù†Ø¸Ø§Ù… Ø¯ÙØ¹ Ù…ØªÙƒØ§Ù…Ù„ ÙŠØ¹Ù…Ù„ Ø¨ÙƒÙØ§Ø¡Ø©  
âœ… ÙŠØ¯Ø¹Ù… 3 Ø·Ø±Ù‚ Ø¯ÙØ¹ Ù…Ø®ØªÙ„ÙØ©  
âœ… ÙˆØ§Ø¬Ù‡Ø© Ø³Ù‡Ù„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†  
âœ… Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù‚ÙˆÙŠØ© Ù„Ù„Ù…Ø¯ÙŠØ±ÙŠÙ†  
âœ… Ù†Ø¸Ø§Ù… Ù…ÙˆØ§ÙÙ‚Ø© Ø¢Ù…Ù† Ù„Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ©  

ØªÙ… Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù…Ø±ÙˆÙ†Ø© Ø¹Ø§Ù„ÙŠØ© Ù„Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„ØªÙˆØ³Ø¹ ÙˆØ§Ù„ØªØ·ÙˆÙŠØ± ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„! ğŸ‰

