# Consultation Booking System - Architecture Overview

## System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT (Next.js)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Consultations   â”‚  â”‚  Book Consult.   â”‚  â”‚  My Bookings     â”‚  â”‚
â”‚  â”‚  Page            â”‚  â”‚  Page            â”‚  â”‚  Page            â”‚  â”‚
â”‚  â”‚  /consultations  â”‚  â”‚  /book           â”‚  â”‚  /my-bookings    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                     â”‚                      â”‚             â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                 â”‚                                    â”‚
â”‚                                 â–¼                                    â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                     â”‚   Auth Context        â”‚                        â”‚
â”‚                     â”‚   (User Data)         â”‚                        â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                 â”‚                                    â”‚
â”‚                                 â–¼                                    â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                     â”‚   API Client          â”‚                        â”‚
â”‚                     â”‚   consultationsAPI    â”‚                        â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚ HTTP/HTTPS
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API SERVER (Express.js)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                     Middleware Layer                             â”‚ â”‚
â”‚  â”‚  â€¢ authenticate() - JWT validation                              â”‚ â”‚
â”‚  â”‚  â€¢ requireAdmin() - Admin access control                        â”‚ â”‚
â”‚  â”‚  â€¢ requirePermission() - Permission check                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      Route Handlers                              â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚  /api/consultations                                              â”‚ â”‚
â”‚  â”‚    GET    /                  - List consultation types          â”‚ â”‚
â”‚  â”‚    GET    /:id               - Get consultation details         â”‚ â”‚
â”‚  â”‚    POST   /book              - Create booking                   â”‚ â”‚
â”‚  â”‚    GET    /my-bookings       - Get user's bookings             â”‚ â”‚
â”‚  â”‚    PUT    /booking/:id/cancel - Cancel booking                  â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚  /api/payment                                                    â”‚ â”‚
â”‚  â”‚    POST   /paypal/create-order - Create PayPal order           â”‚ â”‚
â”‚  â”‚    POST   /paypal/capture      - Capture payment               â”‚ â”‚
â”‚  â”‚                                                                  â”‚ â”‚
â”‚  â”‚  /api/admin/consultations                                        â”‚ â”‚
â”‚  â”‚    GET    /bookings          - All bookings (admin)             â”‚ â”‚
â”‚  â”‚    PUT    /booking/:id/confirm - Confirm booking               â”‚ â”‚
â”‚  â”‚    GET    /analytics         - Analytics dashboard             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATABASE (MongoDB)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  users           â”‚  â”‚  consultations   â”‚  â”‚  consultation    â”‚  â”‚
â”‚  â”‚  Collection      â”‚  â”‚  Collection      â”‚  â”‚  Bookings        â”‚  â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚  Collection      â”‚  â”‚
â”‚  â”‚  â€¢ _id           â”‚  â”‚  â€¢ _id           â”‚  â”‚  â€¢ _id           â”‚  â”‚
â”‚  â”‚  â€¢ email         â”‚  â”‚  â€¢ title         â”‚  â”‚  â€¢ bookingNumber â”‚  â”‚
â”‚  â”‚  â€¢ displayName   â”‚  â”‚  â€¢ description   â”‚  â”‚  â€¢ userId â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â€¢ phone         â”‚  â”‚  â€¢ price         â”‚  â”‚  â€¢ consultationIdâ”‚  â”‚
â”‚  â”‚  â€¢ gender        â”‚  â”‚  â€¢ duration      â”‚  â”‚  â€¢ preferredDate â”‚  â”‚
â”‚  â”‚  â€¢ fitnessLevel  â”‚  â”‚  â€¢ category      â”‚  â”‚  â€¢ confirmedDate â”‚  â”‚
â”‚  â”‚  â€¢ goals[]       â”‚  â”‚  â€¢ features[]    â”‚  â”‚  â€¢ status        â”‚  â”‚
â”‚  â”‚  â€¢ consultation  â”‚  â”‚  â€¢ isActive      â”‚  â”‚  â€¢ paymentStatus â”‚  â”‚
â”‚  â”‚    Bookings[]    â”‚  â”‚                  â”‚  â”‚  â€¢ userDetails   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â€¢ orderId       â”‚  â”‚
â”‚           â–²                      â–²            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                      â”‚                     â”‚             â”‚
â”‚           â”‚                      â”‚                     â”‚             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Relationship â”‚  â”‚  Relationship     â”‚  â”‚  orders             â”‚  â”‚
â”‚  â”‚  Reference    â”‚  â”‚  Reference        â”‚  â”‚  Collection         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                     â”‚  â”‚
â”‚                                            â”‚  â€¢ _id              â”‚  â”‚
â”‚                                            â”‚  â€¢ userId           â”‚  â”‚
â”‚                                            â”‚  â€¢ orderType        â”‚  â”‚
â”‚                                            â”‚  â€¢ consultation     â”‚  â”‚
â”‚                                            â”‚    BookingId        â”‚  â”‚
â”‚                                            â”‚  â€¢ amount           â”‚  â”‚
â”‚                                            â”‚  â€¢ status           â”‚  â”‚
â”‚                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EXTERNAL SERVICES                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PayPal API      â”‚  â”‚  Email Service   â”‚  â”‚  Calendar (iCal) â”‚  â”‚
â”‚  â”‚                  â”‚  â”‚  (SendGrid/SMTP) â”‚  â”‚                  â”‚  â”‚
â”‚  â”‚  â€¢ Create Order  â”‚  â”‚  â€¢ Send Confirm  â”‚  â”‚  â€¢ Generate .ics â”‚  â”‚
â”‚  â”‚  â€¢ Capture       â”‚  â”‚  â€¢ Send Reminder â”‚  â”‚  â€¢ Add to Cal    â”‚  â”‚
â”‚  â”‚  â€¢ Refund        â”‚  â”‚  â€¢ Send Feedback â”‚  â”‚                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow: Booking a Consultation

### Complete User Journey

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: User Browses Consultations                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                  /consultations page loads
                              â”‚
                              â–¼
                  GET /api/consultations
                              â”‚
                              â–¼
                  Returns all active consultations
                              â”‚
                              â–¼
                  User selects consultation type


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Navigate to Booking Page                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
            /consultations/book?type=CONSULTATION_ID
                              â”‚
                              â–¼
                  Check if user is logged in
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                   â”‚
                    â–¼                   â–¼
              NOT LOGGED IN       LOGGED IN
                    â”‚                   â”‚
                    â–¼                   â–¼
           Redirect to login    Load user data from
           then return          AuthContext
                                        â”‚
                                        â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ AUTO-POPULATE FIELDS:   â”‚
                          â”‚ â€¢ Name: user.displayNameâ”‚
                          â”‚ â€¢ Email: user.email     â”‚
                          â”‚ â€¢ Phone: user.phone     â”‚
                          â”‚ â€¢ Gender: user.gender   â”‚
                          â”‚ â€¢ Fitness: user.fitness â”‚
                          â”‚ â€¢ Goals: user.goals[]   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: User Fills Booking Form                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ USER SELECTS/ENTERS:          â”‚
              â”‚ â€¢ Preferred Date              â”‚
              â”‚ â€¢ Preferred Time              â”‚
              â”‚ â€¢ Meeting Type (online/person)â”‚
              â”‚ â€¢ Health Details:             â”‚
              â”‚   - Age                       â”‚
              â”‚   - Weight, Height            â”‚
              â”‚   - Medical Conditions        â”‚
              â”‚   - Current Activity          â”‚
              â”‚   - Specific Goals            â”‚
              â”‚   - Additional Notes          â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                  User clicks "Ø§Ø­Ø¬Ø² Ø§Ù„Ø¢Ù†"


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: Create Booking (Backend)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
              POST /api/consultations/book
              {
                consultationId: "...",
                preferredDate: "2025-10-25",
                preferredTime: "14:00",
                meetingType: "online",
                userDetails: { ... }
              }
                              â”‚
                              â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ BACKEND VALIDATION:           â”‚
              â”‚ 1. Authenticate user          â”‚
              â”‚ 2. Verify consultation exists â”‚
              â”‚ 3. Check date availability    â”‚
              â”‚ 4. Validate all fields        â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
              Create ConsultationBooking
              {
                bookingNumber: "CB-20251025-0001",
                userId: user._id,
                userEmail: user.email,
                userName: user.displayName,
                userPhone: user.phone,
                ...bookingData,
                status: "pending_payment"
              }
                              â”‚
                              â–¼
                  Save to database
                              â”‚
                              â–¼
              Create Order record
              {
                userId: user._id,
                orderType: "consultation",
                consultationBookingId: booking._id,
                amount: consultation.price,
                status: "pending"
              }


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: Payment Processing                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
              POST /api/payment/paypal/create-order
              {
                consultationBookingId: "..."
              }
                              â”‚
                              â–¼
                  Create PayPal order
                              â”‚
                              â–¼
              Return approval URL to frontend
                              â”‚
                              â–¼
              Redirect user to PayPal
                              â”‚
                              â–¼
              User completes payment on PayPal
                              â”‚
                              â–¼
              PayPal redirects back
                              â”‚
                              â–¼
              POST /api/payment/paypal/capture
              {
                orderId: "paypal_order_id"
              }


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 6: Payment Confirmation & Booking Update                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ UPDATE RECORDS:               â”‚
              â”‚                               â”‚
              â”‚ Order:                        â”‚
              â”‚ â€¢ status â†’ "completed"        â”‚
              â”‚ â€¢ completedAt â†’ now           â”‚
              â”‚                               â”‚
              â”‚ ConsultationBooking:          â”‚
              â”‚ â€¢ paymentStatus â†’ "completed" â”‚
              â”‚ â€¢ status â†’ "pending_confirm"  â”‚
              â”‚   or "confirmed" if no approvalâ”‚
              â”‚ â€¢ paymentCompletedAt â†’ now    â”‚
              â”‚                               â”‚
              â”‚ User:                         â”‚
              â”‚ â€¢ consultationBookings.push() â”‚
              â”‚ â€¢ totalSpent += amount        â”‚
              â”‚ â€¢ totalConsultations += 1     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ SEND NOTIFICATIONS:           â”‚
              â”‚ â€¢ Email to user (confirmation)â”‚
              â”‚ â€¢ Email to admin (new booking)â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
              Redirect to success page
              /consultations/booking/CB-20251025-0001


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 7: Admin Confirmation (If Required)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
              Admin logs into admin panel
                              â”‚
                              â–¼
              GET /api/admin/consultations/bookings
              ?status=pending_confirmation
                              â”‚
                              â–¼
              Admin reviews booking details
                              â”‚
                              â–¼
              Admin confirms booking
                              â”‚
                              â–¼
              PUT /api/admin/consultations/booking/:id/confirm
              {
                confirmedDateTime: "2025-10-25T14:00:00Z",
                meetingLink: "https://zoom.us/...",
                adminNotes: "..."
              }
                              â”‚
                              â–¼
              Update booking:
              â€¢ status â†’ "confirmed"
              â€¢ confirmedDateTime â†’ set
              â€¢ confirmedAt â†’ now
                              â”‚
                              â–¼
              Send email to user:
              "Your consultation is confirmed!"
              + Meeting link
              + Calendar invite (.ics)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 8: Reminders                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
              Cron job runs daily
                              â”‚
                              â–¼
              Find bookings where:
              confirmedDateTime - 24 hours = today
                              â”‚
                              â–¼
              Send reminder email:
              "Your consultation is tomorrow!"
                              â”‚
                              â–¼
              1 hour before:
              "Your consultation starts in 1 hour"
              + Meeting link


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 9: Consultation Day                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
              User goes to "My Bookings"
                              â”‚
                              â–¼
              GET /api/consultations/my-bookings
              ?upcoming=true
                              â”‚
                              â–¼
              Shows upcoming consultation
              with "Join Meeting" button
                              â”‚
                              â–¼
              User clicks "Join Meeting"
                              â”‚
                              â–¼
              Opens Zoom/Google Meet link
                              â”‚
                              â–¼
              Consultation happens! ğŸ¯


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 10: Post-Consultation                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
              Admin marks consultation complete
                              â”‚
                              â–¼
              PUT /api/admin/consultations/booking/:id/complete
              {
                adminNotes: "Great session, user progressing well",
                followUpRequired: true,
                followUpDate: "2025-11-25"
              }
                              â”‚
                              â–¼
              Update booking:
              â€¢ status â†’ "completed"
              â€¢ completedAt â†’ now
                              â”‚
                              â–¼
              Send feedback request email
                              â”‚
                              â–¼
              User submits feedback
                              â”‚
                              â–¼
              POST /api/consultations/booking/:id/feedback
              {
                rating: 5,
                comment: "Ø§Ø³ØªØ´Ø§Ø±Ø© Ù…Ù…ØªØ§Ø²Ø©ØŒ Ø§Ø³ØªÙØ¯Øª ÙƒØ«ÙŠØ±Ø§Ù‹!"
              }
                              â”‚
                              â–¼
              Update booking with feedback
                              â”‚
                              â–¼
              âœ… BOOKING LIFECYCLE COMPLETE!
```

---

## Key Features: Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© (Personal Information)

### How User Information Flows

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER REGISTRATION/LOGIN                        â”‚
â”‚                                                                   â”‚
â”‚  User registers or logs in                                       â”‚
â”‚  Profile stored in MongoDB users collection:                     â”‚
â”‚  {                                                               â”‚
â”‚    _id: "user_123",                                              â”‚
â”‚    email: "ahmad@example.com",                                   â”‚
â”‚    displayName: "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯",                                     â”‚
â”‚    phone: "+966501234567",                                       â”‚
â”‚    gender: "male",                                               â”‚
â”‚    fitnessLevel: "intermediate",                                 â”‚
â”‚    goals: ["Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¹Ø¶Ù„Ø§Øª", "Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù‚ÙˆØ©"]                       â”‚
â”‚  }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FRONTEND AUTH CONTEXT                          â”‚
â”‚                                                                   â”‚
â”‚  When user logs in, AuthContext loads:                           â”‚
â”‚  const { user } = useAuth();                                     â”‚
â”‚                                                                   â”‚
â”‚  user = {                                                        â”‚
â”‚    _id: "user_123",                                              â”‚
â”‚    email: "ahmad@example.com",                                   â”‚
â”‚    displayName: "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯",                                     â”‚
â”‚    phone: "+966501234567",                                       â”‚
â”‚    ...all user fields                                            â”‚
â”‚  }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                BOOKING PAGE AUTO-POPULATION                       â”‚
â”‚                                                                   â”‚
â”‚  /consultations/book page:                                       â”‚
â”‚                                                                   â”‚
â”‚  const { user } = useAuth();                                     â”‚
â”‚                                                                   â”‚
â”‚  <Input                                                          â”‚
â”‚    label="Ø§Ù„Ø§Ø³Ù…"                                                  â”‚
â”‚    value={user.displayName}  â† AUTO-FILLED                       â”‚
â”‚    readOnly                                                      â”‚
â”‚  />                                                              â”‚
â”‚                                                                   â”‚
â”‚  <Input                                                          â”‚
â”‚    label="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"                                     â”‚
â”‚    value={user.email}        â† AUTO-FILLED                       â”‚
â”‚    readOnly                                                      â”‚
â”‚  />                                                              â”‚
â”‚                                                                   â”‚
â”‚  <Input                                                          â”‚
â”‚    label="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ"                                            â”‚
â”‚    value={user.phone || ''}  â† AUTO-FILLED (editable if empty)  â”‚
â”‚  />                                                              â”‚
â”‚                                                                   â”‚
â”‚  <Select                                                         â”‚
â”‚    label="Ø§Ù„Ø¬Ù†Ø³"                                                  â”‚
â”‚    value={user.gender}       â† AUTO-FILLED                       â”‚
â”‚  />                                                              â”‚
â”‚                                                                   â”‚
â”‚  <Select                                                         â”‚
â”‚    label="Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠ"                                       â”‚
â”‚    value={user.fitnessLevel} â† AUTO-FILLED                       â”‚
â”‚  />                                                              â”‚
â”‚                                                                   â”‚
â”‚  User only needs to fill:                                        â”‚
â”‚  â€¢ Preferred date/time                                           â”‚
â”‚  â€¢ Meeting type                                                  â”‚
â”‚  â€¢ Additional health details (weight, height, conditions, etc.)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  BACKEND RECEIVES BOOKING                         â”‚
â”‚                                                                   â”‚
â”‚  Request comes with JWT token                                    â”‚
â”‚  Middleware extracts user from token: req.user                   â”‚
â”‚                                                                   â”‚
â”‚  Backend creates booking with:                                   â”‚
â”‚  {                                                               â”‚
â”‚    userId: req.user._id,           â† FROM DB                     â”‚
â”‚    userEmail: req.user.email,      â† FROM DB                     â”‚
â”‚    userName: req.user.displayName, â† FROM DB                     â”‚
â”‚    userPhone: req.user.phone,      â† FROM DB                     â”‚
â”‚    ...requestData (date, time, health info)                      â”‚
â”‚  }                                                               â”‚
â”‚                                                                   â”‚
â”‚  âœ… User info is ALWAYS from authenticated database user         â”‚
â”‚  âœ… Cannot be spoofed or manipulated                             â”‚
â”‚  âœ… Always up-to-date with user profile                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Database Schema Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         RELATIONSHIPS                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    User (1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (Many) ConsultationBooking
      â”‚                          â”‚
      â”‚                          â”‚
      â”‚                          â”œâ”€â”€â”€ consultationId â†’ Consultation (1)
      â”‚                          â”‚
      â”‚                          â””â”€â”€â”€ orderId â†’ Order (1)
      â”‚
      â””â”€â”€â”€ consultationBookings[] (Array of booking IDs)


EXAMPLE DATA:

User Document:
{
  _id: "user_123",
  email: "ahmad@example.com",
  displayName: "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯",
  phone: "+966501234567",
  consultationBookings: [
    "booking_001",
    "booking_002"
  ],
  totalConsultations: 2,
  totalSpent: 150
}

ConsultationBooking Document:
{
  _id: "booking_001",
  bookingNumber: "CB-20251025-0001",
  userId: "user_123",          â† References User
  userEmail: "ahmad@example.com",
  userName: "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯",
  userPhone: "+966501234567",
  consultationId: "consult_5",  â† References Consultation
  orderId: "order_789",         â† References Order
  status: "confirmed",
  paymentStatus: "completed"
}

Consultation Document:
{
  _id: "consult_5",
  consultationId: 5,
  title: "Ø§Ø³ØªØ´Ø§Ø±Ø© Ø§Ù„ØªÙˆØ§Ø²Ù† Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù…Ù„ ÙˆØ§Ù„Ø­ÙŠØ§Ø©",
  price: 50,
  duration: "60 Ø¯Ù‚ÙŠÙ‚Ø©",
  category: "life_coaching"
}

Order Document:
{
  _id: "order_789",
  userId: "user_123",
  orderType: "consultation",
  consultationBookingId: "booking_001",
  amount: 50,
  status: "completed"
}
```

---

## Security & Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AUTHENTICATION FLOW                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. User Login
   â””â”€> POST /api/auth/login
       â””â”€> Backend validates credentials
           â””â”€> Returns JWT token
               â””â”€> Frontend stores in cookie

2. Booking Request
   â””â”€> POST /api/consultations/book
       â””â”€> Include JWT token in headers
           Authorization: Bearer <token>

3. Backend Middleware
   â””â”€> authenticate() middleware
       â””â”€> Verify JWT token
           â””â”€> Decode user ID
               â””â”€> Fetch user from database
                   â””â”€> Attach to req.user
                       â””â”€> Proceed to route handler

4. Route Handler
   â””â”€> Access authenticated user data
       const userId = req.user._id;
       const userEmail = req.user.email;
       const userName = req.user.displayName;
       
       âœ… GUARANTEED to be authentic user from database
       âœ… Cannot be tampered with
       âœ… Always current data


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AUTHORIZATION LEVELS                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PUBLIC (No Auth Required):
â”œâ”€ GET /api/consultations
â””â”€ GET /api/consultations/:id

AUTHENTICATED USER:
â”œâ”€ POST /api/consultations/book
â”œâ”€ GET /api/consultations/my-bookings
â”œâ”€ GET /api/consultations/booking/:id    (own bookings only)
â”œâ”€ PUT /api/consultations/booking/:id/cancel
â””â”€ POST /api/consultations/booking/:id/feedback

ADMIN ONLY:
â”œâ”€ POST /api/consultations (create type)
â”œâ”€ PUT /api/consultations/:id (update type)
â”œâ”€ DELETE /api/consultations/:id
â”œâ”€ GET /api/admin/consultations/bookings (all bookings)
â”œâ”€ PUT /api/admin/consultations/booking/:id/confirm
â””â”€ GET /api/admin/consultations/analytics
```

---

## Summary

This consultation booking system is designed to:

1. **Seamlessly integrate with existing architecture** (users, orders, payments)
2. **Auto-populate user information** from the authenticated user database
3. **Provide a complete booking lifecycle** from browsing to completion
4. **Support both user and admin workflows**
5. **Include payment processing** via PayPal
6. **Send automated notifications** and reminders
7. **Track analytics** for business insights

The key differentiator is that all **Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© (personal information)** comes directly from the authenticated user's database record, ensuring data integrity and security while providing a smooth user experience.

